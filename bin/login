#!/usr/bin/env ruby

require "ferrum"

loop do
  print("Open a browser to log in? [Y/n] ")
  response = gets.strip
  case response.downcase
  when "n"
    exit
  when "y", ""
    break
  else
    puts "Invalid answer"
  end
end
puts "Opening browser, please log in."

browser = Ferrum::Browser.new(headless: false)
browser.goto("https://adventofcode.com/auth/login")

print "Waiting for login"

session_cookie = nil
loop do
  session_cookie = browser.cookies["session"]
  break if session_cookie && session_cookie.domain == ".adventofcode.com"

  print "."
  sleep 1
end
puts

File.write("cache/session", session_cookie.value)
puts "Wrote your session cookie to `cache/session`!"
